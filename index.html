<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- the above line will make the site responsive  -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
  <title>Deezer API</title>
</head>


<body>
  <!--start div for heading including Title and Search Bar  -->
  <div class="container">
    <div id="dz-root"></div>
    <div class="row">
      <div class="col">
        <h1><a href="index.html">Deezer API</a></h1>
      </div>
    <div class="col">
      <form>
        <div class="form-inline">
          <input class="form-control" type="text"/>
          <button class="btn btn-primary">Search</button>
        </div>
      </form>

    </div>
  </div>
  <!--End div for heading including Title and Search Bar  -->
  <!--Sucess Message  -->
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <p id="success_message"></p>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  </div>
  <!--Error Message  -->
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <h4 id="error_message"></h4>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  </div>
    <div class="row">
      <h1 id="artist_name"></h1>
      <img id="artist_image"><img/>
    </div>
    <!--"card-columns is a layout from bootstrap"  -->
  <div class="card-columns" id="album_list"></div>
</div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://e-cdns-files.dzcdn.net/js/min/dz.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
  <script>
    var artist_info;
    var album_list = [];

    function getArtistInfo(artist_name) {
      return new Promise(function(resolve, reject) {
        DZ.api("/search/artist?q="+artist_name+"&limit=1", function(response) {

          if (response.data[0] == undefined) {
            console.log("Error found");
            $("#error_message").html("Cannot be displayed due to an error!");
            $("#artist_image").attr("src", "no_artist_information.png");

            clearArtistInfo();

            // Print error message
          }
          else {
            artist_info = response.data[0];
            resolve();
          }

        });

        setTimeout(function() { reject("artist information request connection timed out") }, 2500);
      });
    }

    function getAlbumData() {
      return new Promise(function(resolve, reject) {
        DZ.api("/artist/"+artist_info.id+"/albums?limit=200", function(response) {
          album_list = album_list.concat(response.data);

          // resolve final promise for the last set of albums
          resolve();
        });

        setTimeout(function() { reject("album data request connection timed out") }, 2500);
      });
    }
// This fuction removes Artist Information on bad search.
    function clearArtistInfo() {
      $('#album_list').html("");
      $('#artist_name').html("");
      $('#error_message').html("");
    }
// This funtion display Artist Infomation on Success
    function displayArtistInfo() {

      // clear all <p>aragraphs before
      clearArtistInfo();
      $("#success_message").html("SUCCESS! It Displayed Something!");
      $("#artist_name").html(artist_info.name);
      $("#artist_image").attr("src", artist_info.picture_big);

      // $("#track_list").html(response.data[0].tracklist);
      for (var i = 0; i < album_list.length; i++) {
        $('#album_list').append('<div class="card" style="width: 250px;"><img src="'+album_list[i].cover_medium+'"/><h5 class="card-title">' + album_list[i].title + '</h5></div>');
      }
    }

    $("form").submit(function(event) {
      event.preventDefault();
      var artist = $('input').val();

      getArtistInfo(artist).then(
        function() {
          return getAlbumData();
        }
      ).then(
        function(continueAlbumData) {
          displayArtistInfo();
        }
      ).catch(function(reason) {
        console.log(reason);
      });

      // DZ.api("/search/artist?q="+artist+"&limit=1", function(response) {
      //   console.log(response);
      //   artist_info = response.data[0];
      //   // for (var i=0 in response.data[0]) {
      //   // console.log(response.data[0],response.data[0][i]); };
      //   $("#artist_name").html(response.data[0].name);
      //   $("img").attr("src", response.data[0].picture_big);
      //   $("#track_list").html(response.data[0].tracklist);
      //   // DZ.api("/search/album?q="+artist+"&limit=5", function(response) {
      //   //   console.log(response);
      //   // });
      // });
    });
  </script>
</body>
</html>
